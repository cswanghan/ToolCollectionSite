<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿å·¥å…·å¯¼èˆªç«™ - ToolNavi</title>
    <meta name="description" content="ä¸€ä¸ªæç®€ã€æ— å¹²æ‰°çš„ä¸‡èƒ½åœ¨çº¿å·¥å…·å¯¼èˆªã€‚ä¸€é”®ç›´è¾¾ï¼Œé«˜æ•ˆè§£å†³ä½ çš„å¼€å‘ã€è¿è¥å’Œå­¦ä¹ éœ€æ±‚ã€‚">
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA Manifest (Placeholder) -->
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#ffffff">

    <style>
        /* åŸºæœ¬æ ·å¼å’Œå­—ä½“ */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* é¿å…CLS (Cumulative Layout Shift) */
        .app-shell { min-height: 100vh; }
        /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ (å¯é€‰) */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #555; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #777; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <div id="app" class="app-shell flex flex-col">
        <!-- å¤´éƒ¨å¯¼èˆª (Header) -->
        <header class="sticky top-0 z-40 w-full border-b border-slate-200 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-900/80 backdrop-blur-sm">
            <div class="container mx-auto px-4 h-16 flex items-center justify-between">
                <!-- LOGO -->
                <a href="#" id="logo-link" class="flex items-center gap-2 text-xl font-bold">
                    <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V3m0 18v-3M5.636 5.636l-1.414-1.414m15.556 15.556l-1.414-1.414M18.364 5.636l-1.414 1.414m-11.314 11.314l-1.414 1.414"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18a6 6 0 100-12 6 6 0 000 12z"></path></svg>
                    <span>ToolNavi</span>
                </a>

                <!-- æœç´¢æ¡† -->
                <div class="flex-1 max-w-lg mx-4">
                    <div class="relative">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input id="search-input" type="search" placeholder="æœç´¢å·¥å…·ï¼Œå¦‚ JSONã€Color..." class="w-full pl-10 pr-4 py-2 rounded-lg border bg-slate-100 dark:bg-slate-800 border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                    </div>
                </div>

                <!-- å³ä¾§æ“ä½œ -->
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="w-10 h-10 rounded-lg flex items-center justify-center hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                        <svg id="theme-icon-light" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-dark" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <button id="login-button" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">ç™»å½•</button>
                </div>
            </div>
        </header>

        <main class="flex-1 container mx-auto px-4 py-8">
            <!-- é¡µé¢å®¹å™¨ -->
            <div id="page-container">
                <!-- é¦–é¡µ -->
                <div id="home-page" class="page active">
                    <!-- åˆ†ç±»å¯¼èˆª -->
                    <nav id="category-tabs" class="mb-8 border-b border-slate-200 dark:border-slate-700">
                        <div class="flex space-x-6 -mb-px overflow-x-auto">
                            <!-- JS åŠ¨æ€æ¸²æŸ“ -->
                        </div>
                    </nav>
                    <!-- å·¥å…·åˆ—è¡¨ -->
                    <div id="home-tool-list" class="space-y-10">
                        <!-- JS åŠ¨æ€æ¸²æŸ“ -->
                    </div>
                    <!-- å¹¿å‘Šä½ -->
                    <div class="mt-12">
                        <div class="w-full max-w-[970px] h-[90px] mx-auto bg-slate-200 dark:bg-slate-800 rounded-lg flex items-center justify-center text-slate-500">
                            [Banner å¹¿å‘Šä½ 970Ã—90]
                        </div>
                    </div>
                </div>

                <!-- åˆ†ç±»åˆ—è¡¨é¡µ -->
                <div id="category-page" class="page">
                    <!-- é¢åŒ…å±‘ -->
                    <div id="category-breadcrumbs" class="mb-4 text-sm text-slate-500 dark:text-slate-400"></div>
                    <!-- æ ‡é¢˜å’Œæ“ä½œ -->
                    <div class="flex justify-between items-center mb-6">
                        <h1 id="category-title" class="text-3xl font-bold"></h1>
                        <div class="flex items-center gap-4">
                            <!-- æ’åºå’Œè§†å›¾åˆ‡æ¢ -->
                            <span class="text-sm">æ’åº: <button class="font-semibold">çƒ­åº¦â–¼</button></span>
                            <div class="flex items-center gap-1 p-1 rounded-lg bg-slate-200 dark:bg-slate-800">
                                <button class="p-1.5 rounded-md bg-white dark:bg-slate-700 shadow"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM13 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2z"/></svg></button>
                                <button class="p-1.5 rounded-md"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg></button>
                            </div>
                        </div>
                    </div>
                    <!-- å·¥å…·ç½‘æ ¼ -->
                    <div id="category-tool-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- JS åŠ¨æ€æ¸²æŸ“ -->
                    </div>
                </div>

                <!-- å·¥å…·è¯¦æƒ…é¡µ -->
                <div id="tool-detail-page" class="page">
                    <!-- é¢åŒ…å±‘ -->
                    <div id="tool-breadcrumbs" class="mb-6 text-sm text-slate-500 dark:text-slate-400"></div>
                    <div class="max-w-4xl mx-auto">
                        <div class="flex items-start gap-6 mb-8">
                            <div id="tool-detail-logo" class="w-20 h-20 rounded-xl bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-3xl font-bold text-slate-500"></div>
                            <div>
                                <h1 id="tool-detail-name" class="text-4xl font-bold mb-2"></h1>
                                <p id="tool-detail-desc" class="text-lg text-slate-600 dark:text-slate-300 mb-3"></p>
                                <div id="tool-detail-tags" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 mb-12">
                            <a id="tool-detail-use-btn" href="#" target="_blank" class="inline-flex items-center gap-2 px-8 py-3 text-lg font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-transform hover:scale-105">
                                ğŸ‘‰ ç«‹å³ä½¿ç”¨
                            </a>
                            <button id="tool-detail-fav-btn" class="flex items-center gap-2 px-6 py-3 text-lg font-semibold border-2 border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                                <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                                <span>æ”¶è—</span>
                            </button>
                        </div>
                        <div class="border-t border-slate-200 dark:border-slate-700 pt-8">
                            <h2 class="text-2xl font-bold mb-4">âš¡ ç›¸å…³å·¥å…·</h2>
                            <div id="related-tools-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                <!-- JS åŠ¨æ€æ¸²æŸ“ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- é¡µè„š (Footer) -->
        <footer class="border-t border-slate-200 dark:border-slate-700">
            <div class="container mx-auto px-4 py-6 text-center text-sm text-slate-500 dark:text-slate-400">
                <p>&copy; 2025 ToolNavi. All Rights Reserved. Inspired by PRD. Crafted with â¤ï¸.</p>
                <p class="mt-2">
                    <a href="#" class="hover:text-blue-500">å…³äºæˆ‘ä»¬</a> Â· 
                    <a href="#" class="hover:text-blue-500">éšç§æ”¿ç­–</a> Â· 
                    <a href="#" class="hover:text-blue-500">è”ç³»æˆ‘ä»¬</a>
                </p>
            </div>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- æ•°æ®ä¸­å¿ƒ (Data Center) ---
        // æ¨¡æ‹Ÿä»åç«¯/CMSè·å–çš„æ•°æ®
        const db = {
            categories: [
                { id: 'favorites', name: 'â­ æ”¶è—', slug: 'favorites' },
                { id: 'recent', name: 'ğŸ•’ æœ€è¿‘ä½¿ç”¨', slug: 'recent' },
                { id: 'dev', name: 'å¼€å‘å·¥å…·', slug: 'dev' },
                { id: 'text', name: 'æ–‡æœ¬å·¥å…·', slug: 'text' },
                { id: 'image', name: 'å›¾ç‰‡éŸ³å½±', slug: 'image' },
                { id: 'life', name: 'ç”Ÿæ´»å¸¸ç”¨', slug: 'life' },
            ],
            tools: [
                // å¼€å‘å·¥å…·
                { id: 'json-beautifier', cat: 'dev', name: 'JSON æ ¼å¼åŒ–', desc: 'æ”¯æŒ JSON æ ¼å¼åŒ–ã€å‹ç¼©ã€æ ¡éªŒå’Œé«˜äº®ã€‚', url: 'http://json.cn', tags: ['JSON', 'Beautify', 'Format', 'Dev'], hot: 95 },
                { id: 'jwt-decoder', cat: 'dev', name: 'JWT è§£ç ', desc: 'åœ¨çº¿è§£ç  JWT Tokenï¼ŒæŸ¥çœ‹ Header å’Œ Payloadã€‚', url: 'https://jwt.io', tags: ['JWT', 'Auth', 'Decode'], hot: 92 },
                { id: 'regex-tester', cat: 'dev', name: 'æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•', desc: 'å®æ—¶æµ‹è¯•ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚', url: 'https://regex101.com/', tags: ['Regex', 'Test', 'Dev'], hot: 98 },
                { id: 'timestamp-converter', cat: 'dev', name: 'æ—¶é—´æˆ³è½¬æ¢', desc: 'Unix æ—¶é—´æˆ³å’Œæ ‡å‡†æ—¥æœŸæ—¶é—´æ ¼å¼äº’è½¬ã€‚', url: 'https://www.tool.lu/timestamp/', tags: ['Timestamp', 'Date', 'Time'], hot: 88 },
                { id: 'base64-encoder', cat: 'dev', name: 'Base64 ç¼–ç /è§£ç ', desc: 'å¯¹æ–‡æœ¬æˆ–æ–‡ä»¶è¿›è¡Œ Base64 ç¼–ç å’Œè§£ç ã€‚', url: 'https://www.base64encode.org/', tags: ['Base64', 'Encode', 'Decode'], hot: 85 },
                { id: 'uuid-generator', cat: 'dev', name: 'UUID ç”Ÿæˆå™¨', desc: 'ä¸€é”®ç”Ÿæˆç¬¦åˆæ ‡å‡†çš„ UUID/GUIDã€‚', url: 'https://www.uuidgenerator.net/', tags: ['UUID', 'GUID', 'Generator'], hot: 80 },
                { id: 'diff-checker', cat: 'dev', name: 'æ–‡æœ¬å·®å¼‚å¯¹æ¯”', desc: 'åœ¨çº¿æ¯”å¯¹ä¸¤ä¸ªæ–‡æœ¬æˆ–ä»£ç çš„å·®å¼‚ã€‚', url: 'https://www.diffchecker.com/', tags: ['Diff', 'Compare', 'Text'], hot: 78 },
                // æ–‡æœ¬å·¥å…·
                { id: 'md-editor', cat: 'text', name: 'Markdown ç¼–è¾‘å™¨', desc: 'å®æ—¶é¢„è§ˆçš„ Markdown åœ¨çº¿ç¼–è¾‘å™¨ã€‚', url: 'https://stackedit.io/', tags: ['Markdown', 'Editor', 'Write'], hot: 90 },
                { id: 'text-formatter', cat: 'text', name: 'æ–‡æœ¬æ’ç‰ˆ', desc: 'è‡ªåŠ¨æ ¼å¼åŒ–æ–‡æœ¬ï¼Œå¢åŠ ç©ºæ ¼ã€ä¿®æ­£æ ‡ç‚¹ã€‚', url: 'https://www.tool.lu/text_formatter/', tags: ['Format', 'Typography', 'Text'], hot: 70 },
                { id: 'word-counter', cat: 'text', name: 'å­—æ•°ç»Ÿè®¡', desc: 'å®æ—¶ç»Ÿè®¡æ–‡æœ¬çš„å­—æ•°ã€è¯æ•°å’Œå­—ç¬¦æ•°ã€‚', url: 'https://wordcounter.net/', tags: ['Count', 'Word', 'Statistics'], hot: 65 },
                // å›¾ç‰‡éŸ³å½±
                { id: 'image-compressor', cat: 'image', name: 'å›¾ç‰‡å‹ç¼©', desc: 'é«˜æ•ˆå‹ç¼© JPG, PNG, GIF å›¾ç‰‡å¤§å°ã€‚', url: 'https://tinypng.com/', tags: ['Image', 'Compress', 'Optimize'], hot: 96 },
                { id: 'qr-generator', cat: 'image', name: 'äºŒç»´ç ç”Ÿæˆå™¨', desc: 'ç”Ÿæˆè‡ªå®šä¹‰æ ·å¼çš„äºŒç»´ç ã€‚', url: 'https://www.the-qrcode-generator.com/', tags: ['QR Code', 'Generator'], hot: 82 },
                { id: 'color-picker', cat: 'image', name: 'é¢œè‰²é€‰æ‹©å™¨', desc: 'ä»å±å¹•æˆ–å›¾ç‰‡ä¸Šæ‹¾å–é¢œè‰²ï¼Œæ”¯æŒå¤šç§æ ¼å¼ã€‚', url: 'https://imagecolorpicker.com/', tags: ['Color', 'Picker', 'Design'], hot: 89 },
                { id: 'favicon-generator', cat: 'image', name: 'Favicon ç”Ÿæˆå™¨', desc: 'ä»å›¾ç‰‡ç”Ÿæˆå„ç§å°ºå¯¸çš„ç½‘ç«™å›¾æ ‡ã€‚', url: 'https://realfavicongenerator.net/', tags: ['Favicon', 'Icon', 'Web'], hot: 75 },
                // ç”Ÿæ´»å¸¸ç”¨
                { id: 'calculator', cat: 'life', name: 'åœ¨çº¿è®¡ç®—å™¨', desc: 'ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åœ¨çº¿ç§‘å­¦è®¡ç®—å™¨ã€‚', url: 'https://www.desmos.com/scientific', tags: ['Calculate', 'Math'], hot: 60 },
                { id: 'world-clock', cat: 'life', name: 'ä¸–ç•Œæ—¶é’Ÿ', desc: 'æŸ¥çœ‹å…¨çƒä¸»è¦åŸå¸‚å½“å‰æ—¶é—´ã€‚', url: 'https://www.timeanddate.com/worldclock/', tags: ['Time', 'World', 'Clock'], hot: 55 },
            ]
        };

        // --- çŠ¶æ€ç®¡ç† (State Management) ---
        const state = {
            favorites: JSON.parse(localStorage.getItem('toolNaviFavorites')) || [],
            recent: JSON.parse(localStorage.getItem('toolNaviRecent')) || [],
            currentPage: 'home',
            currentCategory: null,
            currentTool: null,
            searchTerm: '',
        };

        // --- DOM å…ƒç´ å¼•ç”¨ ---
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        const elements = {
            app: $('#app'),
            themeToggle: $('#theme-toggle'),
            lightIcon: $('#theme-icon-light'),
            darkIcon: $('#theme-icon-dark'),
            searchInput: $('#search-input'),
            logoLink: $('#logo-link'),
            categoryTabs: $('#category-tabs .flex'),
            homeToolList: $('#home-tool-list'),
            pages: {
                home: $('#home-page'),
                category: $('#category-page'),
                toolDetail: $('#tool-detail-page'),
            },
            category: {
                breadcrumbs: $('#category-breadcrumbs'),
                title: $('#category-title'),
                grid: $('#category-tool-grid'),
            },
            toolDetail: {
                breadcrumbs: $('#tool-breadcrumbs'),
                logo: $('#tool-detail-logo'),
                name: $('#tool-detail-name'),
                desc: $('#tool-detail-desc'),
                tags: $('#tool-detail-tags'),
                useBtn: $('#tool-detail-use-btn'),
                favBtn: $('#tool-detail-fav-btn'),
                relatedGrid: $('#related-tools-grid'),
            }
        };

        // --- æ¸²æŸ“å‡½æ•° (Render Functions) ---

        /**
         * åˆ›å»ºå•ä¸ªå·¥å…·å¡ç‰‡çš„ HTML
         * @param {object} tool - å·¥å…·å¯¹è±¡
         * @returns {string} - HTML å­—ç¬¦ä¸²
         */
        const createToolCardHTML = (tool) => {
            const isFavorite = state.favorites.includes(tool.id);
            // å¦‚æœå·²æ”¶è—ï¼Œåˆ™å§‹ç»ˆå¯è§ï¼›å¦åˆ™ï¼Œä»…åœ¨ç»„æ‚¬åœæ—¶å¯è§
            const favoriteVisibilityClasses = isFavorite ? 'opacity-100' : 'opacity-0 group-hover:opacity-100';

            return `
                <div class="tool-card group relative bg-white dark:bg-slate-800 rounded-lg shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300 border border-transparent hover:border-blue-500" data-tool-id="${tool.id}">
                    
                    <div class="flex items-center p-4 pr-12">
                        <div class="w-12 h-12 rounded-lg bg-slate-100 dark:bg-slate-700 flex-shrink-0 flex items-center justify-center font-bold text-xl text-slate-500">
                            ${tool.name.substring(0, 2)}
                        </div>
                        <div class="ml-4 flex-1 overflow-hidden">
                            <h3 class="font-semibold text-slate-900 dark:text-white truncate">${tool.name}</h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400 truncate">${tool.desc}</p>
                        </div>
                    </div>

                    <button class="favorite-btn absolute top-1/2 -translate-y-1/2 right-3 w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-700 transition-opacity duration-200 ${favoriteVisibilityClasses}" data-tool-id="${tool.id}" title="æ”¶è—">
                        <svg class="w-5 h-5 ${isFavorite ? 'text-yellow-400 fill-current' : 'text-slate-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                    </button>
                </div>
            `;
        };

        /**
         * åœ¨é¦–é¡µæ¸²æŸ“æ‰€æœ‰å·¥å…·ï¼ŒæŒ‰åˆ†ç±»
         */
        const renderHome = () => {
            const visibleCategories = db.categories.filter(c => {
                if (c.id === 'favorites') return state.favorites.length > 0;
                if (c.id === 'recent') return state.recent.length > 0;
                return true;
            });

            elements.homeToolList.innerHTML = visibleCategories.map(cat => {
                let toolsForCat;
                if (cat.id === 'favorites') {
                    toolsForCat = state.favorites.map(id => db.tools.find(t => t.id === id)).filter(Boolean);
                } else if (cat.id === 'recent') {
                    toolsForCat = state.recent.map(id => db.tools.find(t => t.id === id)).filter(Boolean);
                } else {
                    toolsForCat = db.tools.filter(tool => tool.cat === cat.slug);
                }
                
                if(toolsForCat.length === 0) return '';

                return `
                    <section id="category-${cat.slug}">
                        <h2 class="text-2xl font-bold mb-4">${cat.name}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${toolsForCat.map(createToolCardHTML).join('')}
                        </div>
                    </section>
                `;
            }).join('');
            attachCardListeners();
        };
        
        /**
         * æ¸²æŸ“æœç´¢ç»“æœ
         */
        const renderSearchResults = (term) => {
            const lowerTerm = term.toLowerCase();
            const results = db.tools.filter(tool => 
                tool.name.toLowerCase().includes(lowerTerm) ||
                tool.desc.toLowerCase().includes(lowerTerm) ||
                tool.tags.some(tag => tag.toLowerCase().includes(lowerTerm))
            );

            if (results.length === 0) {
                elements.homeToolList.innerHTML = `<div class="text-center py-12 text-slate-500">
                    <p class="text-xl">æ‰¾ä¸åˆ°ä¸ "${term}" ç›¸å…³çš„å·¥å…·</p>
                    <p class="mt-2">è¯·å°è¯•å…¶ä»–å…³é”®è¯ã€‚</p>
                </div>`;
                return;
            }

            elements.homeToolList.innerHTML = `
                <section>
                    <h2 class="text-2xl font-bold mb-4">æœç´¢ç»“æœ (${results.length})</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${results.map(createToolCardHTML).join('')}
                    </div>
                </section>
            `;
            attachCardListeners();
        };

        /**
         * æ¸²æŸ“åˆ†ç±»é¡µ
         */
        const renderCategoryPage = (slug) => {
            const category = db.categories.find(c => c.slug === slug);
            if (!category) {
                navigateTo('home');
                return;
            }
            state.currentCategory = category;

            const toolsForCat = db.tools.filter(t => t.cat === slug).sort((a, b) => b.hot - a.hot);
            
            elements.category.breadcrumbs.innerHTML = `<a href="#" class="hover:text-blue-500 page-link" data-page="home">é¦–é¡µ</a> â€º ${category.name}`;
            elements.category.title.textContent = category.name;
            elements.category.grid.innerHTML = toolsForCat.map(createToolCardHTML).join('');
            
            attachCardListeners();
            attachPageLinkListeners();
        };

        /**
         * æ¸²æŸ“å·¥å…·è¯¦æƒ…é¡µ
         */
        const renderToolDetailPage = (toolId) => {
            const tool = db.tools.find(t => t.id === toolId);
            if (!tool) {
                navigateTo('home');
                return;
            }
            state.currentTool = tool;
            const category = db.categories.find(c => c.slug === tool.cat);

            // é¢åŒ…å±‘
            elements.toolDetail.breadcrumbs.innerHTML = `
                <a href="#" class="hover:text-blue-500 page-link" data-page="home">é¦–é¡µ</a> â€º 
                <a href="#" class="hover:text-blue-500 page-link" data-page="category" data-slug="${category.slug}">${category.name}</a> â€º 
                ${tool.name}
            `;

            // ä¸»è¦ä¿¡æ¯
            elements.toolDetail.logo.textContent = tool.name.substring(0, 2);
            elements.toolDetail.name.textContent = tool.name;
            elements.toolDetail.desc.textContent = tool.desc;
            elements.toolDetail.tags.innerHTML = tool.tags.map(tag => 
                `<span class="px-2 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300 text-xs font-medium rounded-full">#${tag}</span>`
            ).join('');
            
            // æ“ä½œæŒ‰é’®
            elements.toolDetail.useBtn.href = tool.url;
            elements.toolDetail.useBtn.dataset.toolId = tool.id;
            updateFavoriteButton(elements.toolDetail.favBtn, tool.id);

            // ç›¸å…³å·¥å…· (åŒåˆ†ç±»ä¸‹ï¼Œæ’é™¤è‡ªèº«)
            const relatedTools = db.tools
                .filter(t => t.cat === tool.cat && t.id !== tool.id)
                .sort(() => 0.5 - Math.random()) // éšæœºæ’åº
                .slice(0, 3);
            elements.toolDetail.relatedGrid.innerHTML = relatedTools.map(createToolCardHTML).join('');

            attachCardListeners();
            attachPageLinkListeners();
        };

        /**
         * æ¸²æŸ“åˆ†ç±»å¯¼èˆªæ ‡ç­¾
         */
        const renderCategoryTabs = () => {
            elements.categoryTabs.innerHTML = db.categories
                .filter(c => c.id !== 'favorites' && c.id !== 'recent')
                .map((cat, index) => `
                <button class="category-tab-btn py-3 px-1 border-b-2 font-semibold transition-colors duration-200 ${index === 0 ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-slate-500 hover:border-slate-300 dark:hover:border-slate-600 hover:text-slate-700 dark:hover:text-slate-300'}" data-slug="${cat.slug}">
                    ${cat.name}
                </button>
            `).join('');
            
            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
            if (elements.homeToolList.children.length > 0) {
                 const firstCategorySection = elements.homeToolList.querySelector('section');
                 if(firstCategorySection) {
                    firstCategorySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                 }
            }
        };


        // --- äº¤äº’é€»è¾‘ (Interaction Logic) ---

        /**
         * é¡µé¢å¯¼èˆª
         * @param {string} pageName - 'home', 'category', 'toolDetail'
         * @param {object} [params] - å¯¼èˆªå‚æ•°ï¼Œå¦‚ { slug: 'dev' } æˆ– { toolId: 'json-beautifier' }
         */
        const navigateTo = (pageName, params = {}) => {
            state.currentPage = pageName;
            Object.values(elements.pages).forEach(p => p.classList.remove('active'));

            window.scrollTo(0, 0);

            switch(pageName) {
                case 'home':
                    elements.pages.home.classList.add('active');
                    state.searchTerm = '';
                    elements.searchInput.value = '';
                    renderHome();
                    break;
                case 'category':
                    elements.pages.category.classList.add('active');
                    renderCategoryPage(params.slug);
                    break;
                case 'toolDetail':
                    elements.pages.toolDetail.classList.add('active');
                    renderToolDetailPage(params.toolId);
                    break;
            }
        };

        /**
         * åˆ‡æ¢æ”¶è—çŠ¶æ€
         * @param {string} toolId - å·¥å…·ID
         */
        const toggleFavorite = (toolId) => {
            const index = state.favorites.indexOf(toolId);
            if (index > -1) {
                state.favorites.splice(index, 1);
            } else {
                state.favorites.unshift(toolId);
            }
            localStorage.setItem('toolNaviFavorites', JSON.stringify(state.favorites));
            
            // æ›´æ–°æ‰€æœ‰ç›¸å…³çš„æŒ‰é’®çŠ¶æ€
            $$(`.favorite-btn[data-tool-id="${toolId}"]`).forEach(btn => updateFavoriteButton(btn, toolId));
            if(state.currentPage === 'toolDetail' && state.currentTool.id === toolId) {
                updateFavoriteButton(elements.toolDetail.favBtn, toolId);
            }

            // å¦‚æœåœ¨é¦–é¡µï¼Œé‡æ–°æ¸²æŸ“ä»¥æ˜¾ç¤º/éšè—æ”¶è—åˆ†ç±»
            if (state.currentPage === 'home' && state.searchTerm === '') {
                renderHome();
            }
        };

        /**
         * æ›´æ–°å•ä¸ªæ”¶è—æŒ‰é’®çš„UI
         */
        const updateFavoriteButton = (btn, toolId) => {
            const isFavorite = state.favorites.includes(toolId);
            const svg = btn.querySelector('svg');
            const span = btn.querySelector('span');

            // æ›´æ–°å¡ç‰‡ä¸Šçš„æŒ‰é’®
            btn.classList.toggle('opacity-100', isFavorite);
            btn.classList.toggle('opacity-0', !isFavorite);

            if (svg) {
                svg.classList.toggle('text-yellow-400', isFavorite);
                svg.classList.toggle('fill-current', isFavorite);
                svg.classList.toggle('text-slate-400', !isFavorite);
            }
            // æ›´æ–°è¯¦æƒ…é¡µçš„æŒ‰é’®
            if (span) {
                span.textContent = isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—';
            }
        };

        /**
         * è®°å½•æœ€è¿‘ä½¿ç”¨çš„å·¥å…·
         */
        const recordRecentTool = (toolId) => {
            state.recent = state.recent.filter(id => id !== toolId); // ç§»é™¤æ—§è®°å½•
            state.recent.unshift(toolId); // æ·»åŠ åˆ°æœ€å‰
            if (state.recent.length > 5) { // ä¿æŒæœ€å¤š5æ¡è®°å½•
                state.recent.pop();
            }
            localStorage.setItem('toolNaviRecent', JSON.stringify(state.recent));
        };

        /**
         * ä¸»é¢˜åˆ‡æ¢
         */
        const handleThemeToggle = () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('toolNaviTheme', isDark ? 'dark' : 'light');
            elements.lightIcon.classList.toggle('hidden', isDark);
            elements.darkIcon.classList.toggle('hidden', !isDark);
        };

        /**
         * åˆå§‹åŒ–ä¸»é¢˜
         */
        const initTheme = () => {
            const savedTheme = localStorage.getItem('toolNaviTheme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                elements.lightIcon.classList.add('hidden');
                elements.darkIcon.classList.remove('hidden');
            }
        };

        // --- äº‹ä»¶ç›‘å¬å™¨ç»‘å®š ---
        
        /**
         * ç»‘å®šå¡ç‰‡ç‚¹å‡»äº‹ä»¶ï¼ˆåŒºåˆ†å¡ç‰‡æœ¬èº«å’Œæ”¶è—æŒ‰é’®ï¼‰
         */
        const attachCardListeners = () => {
            $$('.tool-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æ”¶è—æŒ‰é’®ï¼Œåˆ™ä¸è·³è½¬
                    if (e.target.closest('.favorite-btn')) {
                        return;
                    }
                    const toolId = card.dataset.toolId;
                    navigateTo('toolDetail', { toolId });
                });
            });

            $$('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°å¡ç‰‡
                    const toolId = btn.dataset.toolId;
                    toggleFavorite(toolId);
                });
            });
        };
        
        /**
         * ç»‘å®šé¡µé¢é“¾æ¥ç‚¹å‡»äº‹ä»¶ï¼ˆé¢åŒ…å±‘ç­‰ï¼‰
         */
        const attachPageLinkListeners = () => {
             $$('.page-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    const slug = link.dataset.slug;
                    navigateTo(page, { slug });
                });
            });
        };
        
        // ç»‘å®šæ‰€æœ‰äº‹ä»¶
        const bindEvents = () => {
            elements.themeToggle.addEventListener('click', handleThemeToggle);

            elements.logoLink.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('home');
            });
            
            elements.searchInput.addEventListener('input', (e) => {
                const term = e.target.value.trim();
                state.searchTerm = term;
                if (term) {
                    renderSearchResults(term);
                } else {
                    renderHome();
                }
                // åœ¨æœç´¢æ—¶ï¼Œç¡®ä¿æˆ‘ä»¬åœ¨é¦–é¡µè§†å›¾
                if(state.currentPage !== 'home') {
                    Object.values(elements.pages).forEach(p => p.classList.remove('active'));
                    elements.pages.home.classList.add('active');
                    state.currentPage = 'home';
                }
            });

            elements.categoryTabs.addEventListener('click', (e) => {
                const button = e.target.closest('.category-tab-btn');
                if (!button) return;

                // æ›´æ–°Tabæ ·å¼
                $$('.category-tab-btn').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                    btn.classList.add('border-transparent', 'text-slate-500');
                });
                button.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                button.classList.remove('border-transparent', 'text-slate-500');

                // æ»šåŠ¨åˆ°å¯¹åº”åˆ†ç±»
                const slug = button.dataset.slug;
                const section = $(`#category-${slug}`);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            // è¯¦æƒ…é¡µ "ç«‹å³ä½¿ç”¨" æŒ‰é’®
            elements.toolDetail.useBtn.addEventListener('click', (e) => {
                const toolId = e.currentTarget.dataset.toolId;
                if (toolId) {
                    recordRecentTool(toolId);
                    // æ¨¡æ‹Ÿè·³è½¬ç»Ÿè®¡
                    console.log('JUMP_TRACKING:', {
                        tool_id: toolId,
                        ts: new Date().toISOString(),
                        referrer: document.referrer || 'direct',
                    });
                }
            });

            // è¯¦æƒ…é¡µæ”¶è—æŒ‰é’®
            elements.toolDetail.favBtn.addEventListener('click', (e) => {
                if (state.currentTool) {
                    toggleFavorite(state.currentTool.id);
                }
            });
        };

        // --- åˆå§‹åŒ– ---
        const init = () => {
            initTheme();
            renderCategoryTabs();
            navigateTo('home');
            bindEvents();
        };

        init();
    });
    </script>
</body>
</html>

